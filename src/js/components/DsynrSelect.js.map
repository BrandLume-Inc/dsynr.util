{"version":3,"file":"DsynrSelect.js","sourceRoot":"","sources":["../../ts/components/DsynrSelect.ts"],"names":[],"mappings":"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","sourcesContent":["class DsynrSelect extends DsynrUIIElement {\n\n    content: HTMLSelectElement;\n    private trigger: HTMLElement;\n    private esPrevOpt: HTMLElement;\n\n    private options: HTMLOptionsCollection;\n    private option: HTMLOptionElement;\n\n    private adoptParent: boolean;\n    private showFinder: boolean;\n    private autoExit: boolean;\n    private isActive: boolean;\n\n    private triggerCls: string;\n    private optCls: string;\n    private optClsActive: string;\n    private optionPrefix: string;\n\n    private modal: DsynrModal;\n    private modalPref: object;\n\n    constructor(select: HTMLElement, preferences: object = {}) {\n        super(select, preferences);\n        if (!this.selfAbort) {\n            d.lfn('DsynrSelect');\n            this.setDefaults();\n            this.setup();\n        }\n    }\n\n    setDefaults(reset: boolean = false): void {\n\n        super.setDefaults();\n\n        d.lfn('setDefaults');\n\n        this.adoptParent = d.addProp(this, 'adoptParent', true, reset);\n        this.nameSuffix = d.addProp(this, 'nameSuffix', DsynrSelect.instances.length.toString(), reset);\n        this.namePrefix = d.addProp(this, 'namePrefix', 'dsynrEnhancedSelect', reset);\n        this.optionPrefix = d.addProp(this, 'namePrefix', d.concatStr([this.namePrefix, 'option'], '-'), reset);\n        this.instanceClass = d.addProp(this, 'instanceClasses', d.concatStr([this.namePrefix, 'rounded bg-light shadow p-5']), reset);\n        this.showFinder = d.addProp(this, 'showFinder', false, reset);\n        this.autoExit = d.addProp(this, 'autoExit', true, reset);\n        this.isActive = d.addProp(this, 'isActive', false, reset);\n        this.triggerCls = d.addProp(this, 'btnCls', d.concatStr([this.namePrefix, 'trigger btn btn-link'], '-'), reset);\n        this.optCls = d.addProp(this, 'optCls', d.concatStr([this.optionPrefix, 'hand p-2']), reset);\n        this.optClsActive = d.addProp(this, 'optClsActive', 'active bg-warning rounded', reset);\n    }\n\n    setup(): void {\n        d.lfn('setup');\n        if (this.content.id === '') {\n            this.content.id = 'dsynrSelect-' + DsynrSelect.instances.length;\n        }\n        this.options = this.content.options;\n        this.option = this.options[this.options.selectedIndex];\n        this.setTrigger();\n        d.l('Select Trigger READY!');\n    }\n\n    show(): void {\n        d.lfn('show triggered via : ' + this.trigger.id);\n        if (this.isActive) {\n            this.attention();\n        } else {\n            this.instance = d.addDiv(this.setName('', this.content.id), this.instanceClass);\n            this.instance.tabIndex = 0;\n            this.instance.style.outline = 'none';\n            let ths: DsynrSelect = this;\n            d.makeArray(this.options).forEach(function (o: HTMLOptionElement, index: number) {\n                ths.addESOption(o, index);\n            });\n            this.modalPref = d.mergeObjs(this.preferences, {\n                'trigger': 'auto', 'parent': this.parent, 'adoptParent': this.adoptParent, 'onModalDestroy': () => {\n                    ths.destroy();\n                }\n            });\n            this.modal = new DsynrModal(this.instance, this.modalPref);\n            this.setActive();\n        }\n    }\n\n    attention(): void {\n        DsynrSelect.activeInstance = this;\n        this.modal.attention();\n    }\n\n    private update(selectOption: HTMLOptionElement): void {\n        d.lfn('update');\n        d.removeClass(this.esPrevOpt, this.optClsActive);\n        this.option = selectOption;\n        d.addClass(this.option, this.optClsActive);\n        this.esPrevOpt = d.getElementById(selectOption.id);\n        this.content.selectedIndex = parseInt(d.getData(selectOption, 'index'));\n        this.trigger.textContent = this.option.innerText;\n        if (this.autoExit) {\n            this.destroy();\n        }\n    }\n\n    private addESOption(o: HTMLOptionElement, i: number): void {\n        d.lfn('addESOption');\n        let oid: string = d.concatStr([this.optionPrefix, this.content.id, i], '-');\n        let ocls: string;\n        d.l(this.esPrevOpt);\n        ocls = (i == this.content.selectedIndex) ? d.concatStr([this.optCls, this.optClsActive]) : ocls = this.optCls;\n\n        let eso: HTMLElement = d.addDiv(oid, ocls, this.instance);\n        eso.tabIndex = i;\n        eso.style.outline = 'none';\n        if (i == this.option.index) {\n            this.esPrevOpt = eso;\n        }\n        let oe: HTMLOptionElement = <HTMLOptionElement>d.getElementById(oid);\n        oe.textContent = o.text;\n        d.setData(oe, 'index', o.index.toString());\n\n        let ths: DsynrSelect = this;\n        d.addListener(oe.id, 'click', function () {\n            d.lclk(oe.id);\n            ths.update(oe);\n        });\n        d.addListener(oe.id, 'keydown', function (ev) {\n            if (ev.key == 'Enter') {\n                ths.update(oe);\n            }\n        });\n    }\n\n    private setTrigger(): void {\n        d.lfn('addTrigger');\n        this.trigger = d.addDiv(this.setName('btn', this.content.id), this.triggerCls, <HTMLElement>this.content.parentElement);\n        d.addText(this.option.text, this.trigger);\n        let ths: DsynrSelect = this;\n        d.addListener(this.trigger.id, 'click', function (ev) {\n            ev.preventDefault();\n            ths.show();\n        });\n        d.hide(this.content);\n    }\n\n    protected addListeners() {\n        d.lfn('d.addListeners...');\n        let ths: DsynrSelect = this;\n        d.addListener(this.instance.id, 'focus', ev => {\n            d.l('focused!');\n        });\n        d.addListener(this.instance.id, 'keydown', function (evnt: KeyboardEvent) {\n            switch (evnt.key) {\n                case 'ArrowDown':\n                case 'ArrowRight':\n                case 'Tab':\n                    ths.next();\n                    break;\n                case 'ArrowUp':\n                case 'ArrowLeft':\n                    ths.prev();\n                    break;\n                case 'Escape':\n                    ths.destroy();\n                    break;\n            }\n        });\n    }\n\n    private next(): void {\n        d.lfn('next');\n    }\n\n    private prev(): void {\n        d.lfn('prev');\n    }\n\n    destroy() {\n        d.lfn('destroy');\n        this.modal.hide(true);\n        this.isActive = false;\n        DsynrSelect.activeInstance = false;\n    }\n\n    protected setActive(): void {\n        d.lfn('setActive');\n        this.isActive = true;\n        DsynrSelect.activeInstance = this;\n        this.addListeners();\n        this.instance.focus();\n    }\n\n    static auto(selectClass: string = 'dsynrSelect'): void {\n        d.lfn('auto');\n        d.makeArray(d.getElementsByClass(selectClass)).forEach(function (instance) {\n            new DsynrSelect(instance);\n        });\n    }\n}"]}